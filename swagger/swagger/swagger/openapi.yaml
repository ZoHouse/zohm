openapi: 3.0.3
info:
  title: ZO API
  description: |
    RESTful API for user authentication, profile management, and avatar generation.
    Uses phone-based OTP authentication and returns JWT tokens for subsequent requests.
    
    **Key Features:**
    - üì± Phone-based authentication - No passwords, just phone + OTP
    - üîÑ Token refresh - Automatic token renewal
    - üë§ Profile management - User profiles with cultures, locations, and metadata
    - üé® Avatar generation - Zo backend generated avatars (bro/bae body types)
    - üîê Device credentials - Session-based device tracking
    
    **‚ö†Ô∏è CRITICAL - Required Headers:**
    - `client-key`: Your API key (contact dev@zo.xyz)
    - `client-device-id`: Unique device identifier (format: `web-{timestamp}-{random}`)
    - `client-device-secret`: Device secret
    - `Accept: */*` - **MUST be `*/*`, NOT `application/json`**
    - `Accept-Encoding: gzip, deflate`
    - `Connection: keep-alive`
    
    Using `Accept: application/json` will result in a "Missing captcha response" error.
  version: 1.1
  contact:
    email: dev@zo.xyz
    url: https://discord.gg/zo
  license:
    name: Proprietary

servers:
  - url: https://api.io.zo.xyz
    description: Production server

tags:
  - name: Authentication
    description: Phone-based OTP authentication endpoints
  - name: Profile
    description: User profile management endpoints
  - name: Avatar
    description: Avatar generation and status endpoints

paths:
  /api/v1/auth/login/mobile/otp/:
    post:
      tags:
        - Authentication
      summary: Send OTP
      description: Send OTP code to user's phone number via SMS. OTP expires in 5 minutes.
      operationId: sendOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendOTPRequest'
            examples:
              example1:
                value:
                  mobile_country_code: "+1"
                  mobile_number: "5551234567"
                  message_channel: ""
      responses:
        '200':
          description: OTP sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OTPResponse'
        '400':
          description: Bad Request - Invalid phone number or missing fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/login/mobile/:
    post:
      tags:
        - Authentication
      summary: Verify OTP
      description: |
        Verify OTP code and authenticate user. Returns access token, refresh token, 
        device credentials, and user profile. Access token typically expires in 24 hours, 
        refresh token in 30 days.
      operationId: verifyOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyOTPRequest'
            examples:
              example1:
                value:
                  mobile_country_code: "+1"
                  mobile_number: "5551234567"
                  otp: "123456"
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Bad Request - Invalid OTP or missing fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid OTP
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/token/refresh/:
    post:
      tags:
        - Authentication
      summary: Refresh Token
      description: |
        Refresh expired access token using refresh token. If refresh token is also expired, 
        user must re-authenticate with OTP.
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
            examples:
              example1:
                value:
                  refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '401':
          description: Unauthorized - Token is invalid or expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/login/check/:
    get:
      tags:
        - Authentication
      summary: Check Login Status
      description: Validate if user is currently authenticated
      operationId: checkLoginStatus
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Authentication status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginCheckResponse'
        '401':
          description: Unauthorized - Token expired or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/profile/me/:
    get:
      tags:
        - Profile
      summary: Get Profile
      description: |
        Fetch authenticated user's full profile. Returns the most up-to-date profile data. 
        Use this to sync profile changes from other devices.
      operationId: getProfile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '401':
          description: Unauthorized - Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Invalid client-key or device credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Profile
      summary: Update Profile
      description: |
        Update authenticated user's profile. Partial updates supported - only send fields 
        you want to update. Returns full profile after update. Note: body_type can only be 
        changed before avatar generation.
      operationId: updateProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProfileUpdateRequest'
            examples:
              example1:
                value:
                  first_name: "John"
                  last_name: "Doe"
                  bio: "Living consciously and building the future"
                  date_of_birth: "1990-01-01"
                  place_name: "San Francisco, CA"
                  body_type: "bro"
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '400':
          description: Bad Request - Invalid data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/avatar/generate/:
    post:
      tags:
        - Avatar
      summary: Generate Avatar
      description: |
        Start avatar generation for authenticated user. Avatar generation takes 10-60 seconds. 
        Use the returned task_id to poll for status. User can only generate avatar once 
        (or regenerate with new body_type).
      operationId: generateAvatar
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AvatarGenerateRequest'
            examples:
              example1:
                value:
                  body_type: "bro"
      responses:
        '200':
          description: Avatar generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvatarGenerateResponse'
        '400':
          description: Bad Request - Invalid body_type or avatar already generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/avatar/status/{task_id}/:
    get:
      tags:
        - Avatar
      summary: Check Avatar Status
      description: |
        Check avatar generation status. Poll every 2 seconds, max 30 attempts (60 seconds total). 
        Stop when status is "completed" or "failed".
      operationId: checkAvatarStatus
      security:
        - bearerAuth: []
      parameters:
        - name: task_id
          in: path
          required: true
          description: Task ID returned from avatar generation
          schema:
            type: string
            example: "abc123def456"
      responses:
        '200':
          description: Avatar status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvatarStatusResponse'
        '401':
          description: Unauthorized - Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not Found - Invalid task_id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from verify OTP endpoint

  schemas:
    SendOTPRequest:
      type: object
      required:
        - mobile_country_code
        - mobile_number
        - message_channel
      properties:
        mobile_country_code:
          type: string
          description: Country code with + prefix (e.g., "+1")
          example: "+1"
        mobile_number:
          type: string
          description: Phone number without spaces, dashes, or parentheses
          example: "5551234567"
        message_channel:
          type: string
          description: Message channel (should be empty string)
          example: ""

    VerifyOTPRequest:
      type: object
      required:
        - mobile_country_code
        - mobile_number
        - otp
      properties:
        mobile_country_code:
          type: string
          description: Country code with + prefix
          example: "+1"
        mobile_number:
          type: string
          description: Phone number
          example: "5551234567"
        otp:
          type: string
          description: OTP code received via SMS
          example: "123456"

    RefreshTokenRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          description: Refresh token from authentication response
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    OTPResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "OTP sent successfully"

    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        access_token_expiry:
          type: string
          format: date-time
          description: ISO 8601 timestamp when access token expires
          example: "2025-11-23T12:00:00Z"
        refresh_token:
          type: string
          description: JWT refresh token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh_token_expiry:
          type: string
          format: date-time
          description: ISO 8601 timestamp when refresh token expires
          example: "2025-12-22T12:00:00Z"
        client_key:
          type: string
          description: Client key for this session
          example: "your_client_key"
        device_id:
          type: string
          description: "Unique device identifier (format: web-{timestamp}-{random})"
          example: "web-1732291200-abc123"
        device_secret:
          type: string
          description: Device secret for this session
          example: "def456ghi789"
        device_info:
          type: object
          description: Device information
          additionalProperties: true
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string
          description: Legacy field (same as access_token)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        valid_till:
          type: string
          format: date-time
          description: Legacy field (same as access_token_expiry)
          example: "2025-11-23T12:00:00Z"

    RefreshTokenResponse:
      type: object
      properties:
        access:
          type: string
          description: New JWT access token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh:
          type: string
          description: New JWT refresh token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        access_expiry:
          type: string
          format: date-time
          description: ISO 8601 timestamp when new access token expires
          example: "2025-11-23T12:00:00Z"
        refresh_expiry:
          type: string
          format: date-time
          description: ISO 8601 timestamp when new refresh token expires
          example: "2025-12-22T12:00:00Z"

    LoginCheckResponse:
      type: object
      properties:
        authenticated:
          type: boolean
          description: Whether user is authenticated
          example: true

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User UUID
          example: "550e8400-e29b-41d4-a716-446655440000"
        pid:
          type: string
          description: Public user identifier
          example: "PID123"
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        mobile_number:
          type: string
          example: "5551234567"
        email_address:
          type: string
          format: email
          example: "john@example.com"
        date_of_birth:
          type: string
          format: date
          nullable: true
          example: "1990-01-01"
        bio:
          type: string
          example: "Living consciously"
        pfp_image:
          type: string
          format: uri
          description: Profile picture URL
          example: "https://cdn.zo.xyz/avatars/..."
        wallet_address:
          type: string
          description: Wallet address
          example: "0x1234..."
        membership:
          type: string
          enum: [founder, citizen, none]
          example: "founder"
        body_type:
          type: string
          enum: [bro, bae]
          example: "bro"
        place_name:
          type: string
          example: "San Francisco"
        home_location:
          type: object
          nullable: true
          properties:
            lat:
              type: number
              format: float
              example: 37.7749
            lng:
              type: number
              format: float
              example: -122.4194
        cultures:
          type: array
          items:
            $ref: '#/components/schemas/Culture'
        founder_tokens:
          type: array
          items:
            $ref: '#/components/schemas/FounderToken'
        avatar:
          $ref: '#/components/schemas/Avatar'

    UserProfile:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            mobile_country_code:
              type: string
              example: "+1"

    Culture:
      type: object
      properties:
        key:
          type: string
          example: "tech"
        name:
          type: string
          example: "Technology"
        icon:
          type: string
          example: "üñ•Ô∏è"
        description:
          type: string
          example: "Building the future"

    FounderToken:
      type: object
      properties:
        token_id:
          type: string
          example: "123"
        name:
          type: string
          example: "Founder #123"

    Avatar:
      type: object
      properties:
        image:
          type: string
          format: uri
          description: Avatar image URL
          example: "https://cdn.zo.xyz/avatars/..."
        status:
          type: string
          enum: [pending, processing, completed, failed]
          example: "completed"

    ProfileUpdateRequest:
      type: object
      description: All fields are optional - only send fields you want to update
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        bio:
          type: string
          example: "Living consciously and building the future"
        date_of_birth:
          type: string
          format: date
          example: "1990-01-01"
        place_name:
          type: string
          example: "San Francisco, CA"
        body_type:
          type: string
          enum: [bro, bae]
          description: Can only be changed before avatar generation
          example: "bro"

    AvatarGenerateRequest:
      type: object
      required:
        - body_type
      properties:
        body_type:
          type: string
          enum: [bro, bae]
          description: Body type for avatar generation
          example: "bro"

    AvatarGenerateResponse:
      type: object
      properties:
        task_id:
          type: string
          description: Task ID to use for polling status
          example: "abc123def456"
        status:
          type: string
          enum: [pending, processing, completed, failed]
          example: "pending"
        message:
          type: string
          example: "Avatar generation started"

    AvatarStatusResponse:
      type: object
      properties:
        task_id:
          type: string
          example: "abc123def456"
        status:
          type: string
          enum: [pending, processing, completed, failed]
          example: "completed"
        result:
          type: object
          description: Present when status is "completed"
          properties:
            avatar_url:
              type: string
              format: uri
              example: "https://cdn.zo.xyz/avatars/user-123.png"
        error:
          type: string
          description: Present when status is "failed"
          example: "Generation failed"

    ErrorResponse:
      type: object
      description: |
        ZO API can return errors in multiple formats. This schema represents all possible formats.
      oneOf:
        - type: object
          properties:
            success:
              type: boolean
              example: false
            errors:
              type: array
              items:
                type: string
              example: ["Error message here"]
        - type: object
          properties:
            detail:
              type: string
              example: "Error message here"
        - type: object
          properties:
            message:
              type: string
              example: "Error message here"
        - type: object
          properties:
            error:
              type: string
              example: "Error message here"

